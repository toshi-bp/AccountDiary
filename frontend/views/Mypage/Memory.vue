<template>
  <div>
    <center>
      <div>
        <el-alert :title="alertMessage" :type="alertType"></el-alert>
      </div>
    <h3>記録</h3>
    <!-- 支出収入選択 -->
    支出収入を選択してね
    <div>
      <el-select v-model="type" placeholder="Select">
        <el-option
          v-for="item in types"
          :key="item.id"
          :label="item.label"
          :value="item.value"
        >
        </el-option>
      </el-select>
    </div>
    <!-- 日付入力 -->
    日付を選択してね
    <div class="demo-date-picker">
      <div class="block">
        <span class="demonstration"></span>
        <el-date-picker
          v-model="date"
          type="date"
          placeholder="Pick a day"
          :disabled-date="disabledDate"
          :shortcuts="shortcuts"
        >
        </el-date-picker>
      </div>
    </div>
    <!-- 金額入力 -->
    金額を入力してね
    <div>
      <el-input-number v-model="cost" :step="100" />
    </div>
    <!-- カテゴリ選択 -->
    カテゴリを選択してね
    <div>
      <el-select v-model="category" placeholder="Select">
        <el-option
          v-for="item in categoryFilter"
          :key="item.type"
          :label="item.label"
          :value="item.value">
        </el-option>
      </el-select>
    </div>
    <!-- 場所入力 -->
    場所を入力してね
    <div class="memory__input">
      <el-input v-model="place" placeholder="Please input" />
    </div>
    <!-- ひとこと入力 -->
    ひとことを入力してね
    <div class="memory__input">
      <el-input v-model="diary" placeholder="Please input" />
    </div>
    <div>
      <el-upload
        class="upload-demo"
        action="https://jsonplaceholder.typicode.com/posts/"
        :on-preview="handlePreview"
        :on-remove="handleRemove"
        :before-remove="beforeRemove"
        multiple
        :limit="3"
        :on-exceed="handleExceed"
        :file-list="fileList"
      >
        <el-button size="small" type="primary">Click to upload</el-button>
        <template #tip>
          <div class="el-upload__tip">
            jpg/png files with a size less than 500kb
          </div>
        </template>
      </el-upload>
    </div>
    <div>
      <el-button type="primary" plain @click="upload">保存</el-button>
    </div>
    </center>
  </div>
</template>

<script>
import Axios from 'axios'

export default {
  // 支出or収入
  data() {
    return {
      types: [{
        id: 1,
        value: 'income',
        label: '収入'
      }, {
        id: 2,
        value: 'expenditure',
        label: '支出'
      }
      ],
      value: '',
      // ↓収入or支出(income or expenditure)
      type: 'income',
      date: '',
      cost: 0,
      alertMessage: '',
      alertType: '',
      place: '',
      diary: '',
      category: '',
      categories: [
        {
          type: 'income',
          label: '給与',
          value: '給与',
        },
        {
          type: 'income',
          label: 'その他の収入',
          value: 'その他の収入',
        },
        {
          type: 'expenditure',
          label: '生活費',
          value: '生活費',
        },
        {
          type: 'expenditure',
          label: '趣味・娯楽',
          value: '趣味・娯楽',
        },
      ]
    }
  },
  props: {
    userId: {
      type: String
    }
  },
  computed: {
    categoryFilter() {
      return this.categories.filter(item => item.type === this.type)
    }
  },
  methods: {
    // handleRemove(file, fileList) {
    //   console.log(file, fileList)
    // },
    // handlePreview(file) {
    //   console.log(file)
    // },
    // handleExceed(files, fileList) {
    //   this.$message.warning(
    //     `The limit is 3, you selected ${
    //       files.length
    //     } files this time, add up to ${files.length + fileList.length} totally`
    //   )
    // },
    // beforeRemove(file) {
    //   return this.$confirm(`Cancel the transfert of ${file.name} ?`)
    // },
    upload () {
      // 日付を文字列に変換
      const year = this.date.getFullYear()
      const month = this.date.getMonth() + 1
      const date = this.date.getDate()
      const act_time = year.toString() + '/' + month.toString() + '/' + date.toString()
      console.log(act_time)
      // TODO:公開する際にurlを変更
      const BASE_URL = "http://localhost:5000"
      const axios = Axios.create({
        baseURL: BASE_URL,
        headers: {
          'Content-type': 'application/json',
          'X-Requested-With': 'XMLHttpRequest'
        },
        responseType: 'json'
      })
      let self = this
      axios.post(
        '/api/histories/add',
        {
          // 登録するデータ
          id: 0,
          user_id: self.userId,
          action: self.diary,
          result: self.cost,
          act_time: act_time,
          update_time: act_time,
          category: self.category,
          place: self.place
        }
      )
      .then (res => {
        console.table(res.data)
      })
      .catch(() => {
        // エラー発生時(例外処理)
        console.log('failed')
        self.alertType = 'error'
        self.alertMessage = 'エラーが発生しました'
      })
    }
  },
  mounted: async function() {
    // TODO:ページを開いた際にそれぞれのユーザーのカテゴリーを取得する
  },
}
</script>

<style lang="sass" scoped>
.memory
  // 何か書く
  &__input
    width: 250px
    margin-bottom: 1rem
</style>

